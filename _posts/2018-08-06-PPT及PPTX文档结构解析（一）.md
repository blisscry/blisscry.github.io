---
layout:     post
title:      PPT及PPTX文档结构解析
subtitle:   PPT文档
date:       2019-01-25
author:     skaleto
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - ppt&pptx

---

# PPT及PPTX文档结构解析：PPT文档



## 前言

​	由于工作原因，项目上需要通过JNI调用Office的能力，对PPT文档进行播放、翻页等操作，但一个特别的点在于，项目中使用了官方版本Office，并且未激活，这就意味着Office提供的一系列Windows COM组件，其中包含的绝大多数API都无法使用，因为Office COM组件本质上就是调用了Office应用程序的能力，假如Office应用程序在未激活的情况下无法使用某些功能，那么COM组件也无法完成。

​	因此，我们需要解决的就是寻找一个workaround，绕过调用COM组件的环节，直接实现某些功能。项目中对PPT的主要功能要求是需要将PPT的放映模式修改为展台模式，以限制用户操作对文档展示的影响。

------

​	**PowerPoint原生存在三种放映模式：*

​	*(1)普通模式 (present)：即默认的放映模式，在此模式下，用户可以使用鼠标或上下键等进行翻页，用户的任何操作都不会受限*

​	*(2)浏览模式 (browse)：在此模式下，用户可以正常翻页和浏览，但不会显示演讲者视图*

​	*(3)展台模式 (kiosk)：在此模式下，用户的所有操作都会被屏蔽，无法翻页、无法结束*

------

​	如果使用COM组件，则需要调用Office的能力，在PPT文档放映时设置为展台模式，类似如下的操作

![ppt_kiosk_mode](../img/ppt_structure/ppt_kiosk_mode.png)





PPT文件(Office97-2003版本)是二进制的文件结构，文件形式为OLE(Object Linking and Embedding) compound file,是一系列数据块的集合，数据块被称为Record。

不同类别的Record包含不同的配置信息，在名称为DocumentContainer的Record中，包含了一系列的Atom，其中的slideShowDocInfoAtom存放了PPT放映相关的属性。

下图是slideShowDocInfoAtom的数据组成结构，内部存储方式为小字节序。